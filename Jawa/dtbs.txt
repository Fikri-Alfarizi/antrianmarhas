<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('settings', function (Blueprint $table) {
            $table->id();
            $table->string('logo')->nullable();
            $table->string('nama_instansi');
            $table->text('alamat');
            $table->string('telepon');
            $table->text('deskripsi')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('settings');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('layanans', function (Blueprint $table) {
            $table->id();
            $table->string('nama_layanan');
            $table->string('prefix', 5);
            $table->tinyInteger('digit')->default(3);
            $table->enum('status', ['aktif', 'nonaktif'])->default('aktif');
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('layanans');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('lokets', function (Blueprint $table) {
            $table->id();
            $table->string('nama_loket');
            $table->foreignId('layanan_id')->constrained('layanans')->onDelete('cascade');
            $table->enum('status', ['aktif', 'tutup'])->default('aktif');
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('lokets');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('antrians', function (Blueprint $table) {
            $table->id();
            $table->string('kode_antrian');
            $table->foreignId('layanan_id')->constrained('layanans')->onDelete('cascade');
            $table->foreignId('loket_id')->nullable()->constrained('lokets')->onDelete('set null');
            $table->enum('status', ['menunggu', 'dipanggil', 'dilayani', 'selesai', 'batal'])->default('menunggu');
            $table->datetime('waktu_ambil');
            $table->datetime('waktu_panggil')->nullable();
            $table->datetime('waktu_selesai')->nullable();
            $table->string('qr_code')->nullable();
            $table->timestamps();
            
            $table->index('kode_antrian');
            $table->index('status');
            $table->index('waktu_ambil');
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('antrians');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('display_logs', function (Blueprint $table) {
            $table->id();
            $table->foreignId('antrian_id')->constrained('antrians')->onDelete('cascade');
            $table->foreignId('loket_id')->constrained('lokets')->onDelete('cascade');
            $table->string('pesan_display');
            $table->enum('status_warna', ['biru', 'hijau', 'abu', 'merah'])->default('biru');
            $table->datetime('waktu_tampil');
            $table->timestamps();
            
            $table->index('waktu_tampil');
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('display_logs');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('device_printers', function (Blueprint $table) {
            $table->id();
            $table->string('nama_device');
            $table->string('mac_address')->unique();
            $table->enum('status', ['tersambung', 'putus'])->default('putus');
            $table->datetime('last_connected_at')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('device_printers');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('username')->unique();
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->enum('role', ['admin', 'operator'])->default('operator');
            $table->foreignId('loket_id')->nullable()->constrained('lokets')->onDelete('set null');
            $table->enum('status', ['aktif', 'nonaktif'])->default('aktif');
            $table->rememberToken();
            $table->timestamps();
        });

        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });

        Schema::create('sessions', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->foreignId('user_id')->nullable()->index();
            $table->string('ip_address', 45)->nullable();
            $table->text('user_agent')->nullable();
            $table->longText('payload');
            $table->integer('last_activity')->index();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('users');
        Schema::dropIfExists('password_reset_tokens');
        Schema::dropIfExists('sessions');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('activity_logs', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained('users')->onDelete('cascade');
            $table->string('aktivitas');
            $table->datetime('waktu');
            $table->string('ip_address')->nullable();
            $table->timestamps();
            
            $table->index('waktu');
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('activity_logs');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('activity_logs', function (Blueprint $table) {
            $table->string('aktivitas')->default('Aktivitas')->change();
            $table->datetime('waktu')->default(now())->change();
            $table->string('ip_address')->nullable()->change();
        });
    }

    public function down(): void
    {
        Schema::table('activity_logs', function (Blueprint $table) {
            $table->string('aktivitas')->change();
            $table->datetime('waktu')->change();
            $table->string('ip_address')->change();
        });
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('audio_settings', function (Blueprint $table) {
            $table->id();
            $table->string('tipe')->default('text-to-speech'); // text-to-speech atau audio-file
            $table->string('bahasa')->default('id'); // id, en, jv, dst
            $table->integer('volume')->default(100); // 0-100
            $table->boolean('aktif')->default(true);
            $table->string('format_pesan')->default('Nomor {nomor} silakan menuju ke {lokasi}'); // template
            $table->text('voice_url')->nullable(); // URL file audio jika pakai pre-recorded
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('audio_settings');
    }
};


<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        // Tambah kolom waktu_mulai_dilayani ke antrians jika belum ada
        Schema::table('antrians', function (Blueprint $table) {
            if (!Schema::hasColumn('antrians', 'waktu_mulai_dilayani')) {
                $table->datetime('waktu_mulai_dilayani')->nullable()->after('waktu_panggil');
            }
        });
    }

    public function down(): void
    {
        Schema::table('antrians', function (Blueprint $table) {
            if (Schema::hasColumn('antrians', 'waktu_mulai_dilayani')) {
                $table->dropColumn('waktu_mulai_dilayani');
            }
        });
    }
};


<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::table('antrians', function (Blueprint $table) {
            $table->foreignId('transfer_from_antrian_id')->nullable()->constrained('antrians')->onDelete('set null');
            $table->boolean('is_transferred')->default(false);
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('antrians', function (Blueprint $table) {
            $table->dropForeignIdFor('antrians', 'transfer_from_antrian_id');
            $table->dropColumn(['transfer_from_antrian_id', 'is_transferred']);
        });
    }
};


<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('antrian_transfers', function (Blueprint $table) {
            $table->id();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('antrian_transfers');
    }
};


<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('print_histories', function (Blueprint $table) {
            $table->id();
            $table->foreignId('antrian_id')->constrained('antrians')->onDelete('cascade');
            $table->string('kode_antrian');
            $table->integer('print_count')->default(1);
            $table->timestamp('last_printed_at')->nullable();
            $table->string('printed_by')->nullable();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('print_histories');
    }
};

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('advanced_settings', function (Blueprint $table) {
            $table->id();
            // Queue timeout settings
            $table->integer('queue_timeout_minutes')->default(30); // Timeout antrian dalam menit
            $table->boolean('auto_cancel_timeout')->default(true); // Auto cancel jika timeout
            // Display settings
            $table->string('theme_color')->default('#3498db'); // Primary color
            $table->string('secondary_color')->default('#2c3e50'); // Secondary color
            $table->integer('display_refresh_seconds')->default(5); // Refresh rate display
            // Notification settings
            $table->boolean('email_notification_enabled')->default(false);
            $table->string('email_notification_recipient')->nullable();
            $table->boolean('sms_notification_enabled')->default(false);
            $table->string('sms_notification_number')->nullable();
            // Working hours
            $table->time('working_hours_start')->default('08:00');
            $table->time('working_hours_end')->default('17:00');
            $table->json('closed_days')->nullable(); // ['Monday', 'Sunday']
            // Advanced features
            $table->boolean('auto_assign_loket')->default(true);
            $table->integer('max_queue_per_loket')->default(100);
            $table->boolean('enable_customer_feedback')->default(true);
            $table->integer('maintenance_mode')->default(0); // 0=off, 1=on
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('advanced_settings');
    }
};

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class ActivityLog extends Model
{
    use HasFactory;

    protected $table = 'activity_logs';

    protected $fillable = [
        'user_id',
        'action',
        'antrian_id',
        'description',
        'data',
    ];

    protected $casts = [
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
    ];

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class, 'user_id');
    }
}

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class AdvancedSetting extends Model
{
    protected $table = 'advanced_settings';

    protected $fillable = [
        'queue_timeout_minutes',
        'auto_cancel_timeout',
        'theme_color',
        'secondary_color',
        'display_refresh_seconds',
        'email_notification_enabled',
        'email_notification_recipient',
        'sms_notification_enabled',
        'sms_notification_number',
        'working_hours_start',
        'working_hours_end',
        'closed_days',
        'auto_assign_loket',
        'max_queue_per_loket',
        'enable_customer_feedback',
        'maintenance_mode',
    ];

    protected $casts = [
        'auto_cancel_timeout' => 'boolean',
        'email_notification_enabled' => 'boolean',
        'sms_notification_enabled' => 'boolean',
        'auto_assign_loket' => 'boolean',
        'enable_customer_feedback' => 'boolean',
        'closed_days' => 'array',
        'working_hours_start' => 'datetime:H:i',
        'working_hours_end' => 'datetime:H:i',
    ];
}

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Antrian extends Model
{
    use HasFactory;

    protected $table = 'antrians';

    protected $fillable = [
        'kode_antrian',
        'layanan_id',
        'loket_id',
        'status',
        'waktu_ambil',
        'waktu_panggil',
        'waktu_selesai',
        'qr_code'
    ];

    protected $casts = [
        'waktu_ambil' => 'datetime',
        'waktu_panggil' => 'datetime',
        'waktu_selesai' => 'datetime'
    ];

    public function layanan(): BelongsTo
    {
        return $this->belongsTo(Layanan::class, 'layanan_id');
    }

    public function loket(): BelongsTo
    {
        return $this->belongsTo(Loket::class, 'loket_id');
    }

    public function displayLogs(): HasMany
    {
        return $this->hasMany(DisplayLog::class, 'antrian_id');
    }
}


<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class AntrianTransfer extends Model
{
    protected $table = 'antrian_transfers';

    protected $fillable = [
        'antrian_id',
        'from_layanan_id',
        'to_layanan_id',
        'from_loket_id',
        'to_loket_id',
        'kode_antrian_baru',
        'alasan_transfer',
        'status',
        'transferred_by',
        'transferred_at',
    ];

    protected $casts = [
        'transferred_at' => 'datetime',
    ];

    public function antrian()
    {
        return $this->belongsTo(Antrian::class);
    }

    public function fromLayanan()
    {
        return $this->belongsTo(Layanan::class, 'from_layanan_id');
    }

    public function toLayanan()
    {
        return $this->belongsTo(Layanan::class, 'to_layanan_id');
    }

    public function fromLoket()
    {
        return $this->belongsTo(Loket::class, 'from_loket_id');
    }

    public function toLoket()
    {
        return $this->belongsTo(Loket::class, 'to_loket_id');
    }
}


<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class AudioSetting extends Model
{
    protected $table = 'audio_settings';
    
    protected $fillable = [
        'tipe',
        'bahasa',
        'volume',
        'aktif',
        'format_pesan',
        'voice_url',
    ];

    protected $casts = [
        'aktif' => 'boolean',
    ];
}


<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class DevicePrinter extends Model
{
    use HasFactory;

    protected $table = 'device_printers';

    protected $fillable = [
        'nama_device',
        'mac_address',
        'status',
        'last_connected_at'
    ];

    protected $casts = [
        'last_connected_at' => 'datetime'
    ];
}


<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class DisplayLog extends Model
{
    use HasFactory;

    protected $table = 'display_logs';

    protected $fillable = [
        'antrian_id',
        'loket_id',
        'pesan_display',
        'status_warna',
        'waktu_tampil'
    ];

    protected $casts = [
        'waktu_tampil' => 'datetime'
    ];

    public function antrian(): BelongsTo
    {
        return $this->belongsTo(Antrian::class, 'antrian_id');
    }

    public function loket(): BelongsTo
    {
        return $this->belongsTo(Loket::class, 'loket_id');
    }
}


<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Layanan extends Model
{
    use HasFactory;

    protected $table = 'layanans';

    protected $fillable = [
        'nama_layanan',
        'prefix',
        'digit',
        'status'
    ];

    public function lokets(): HasMany
    {
        return $this->hasMany(Loket::class, 'layanan_id');
    }

    public function antrians(): HasMany
    {
        return $this->hasMany(Antrian::class, 'layanan_id');
    }

    public function statistikHarians(): HasMany
    {
        return $this->hasMany(StatistikHarian::class, 'layanan_id');
    }
}


<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Loket extends Model
{
    use HasFactory;

    protected $table = 'lokets';

    protected $fillable = [
        'nama_loket',
        'layanan_id',
        'status'
    ];

    public function layanan(): BelongsTo
    {
        return $this->belongsTo(Layanan::class, 'layanan_id');
    }

    public function antrians(): HasMany
    {
        return $this->hasMany(Antrian::class, 'loket_id');
    }

    public function displayLogs(): HasMany
    {
        return $this->hasMany(DisplayLog::class, 'loket_id');
    }

    public function users(): HasMany
    {
        return $this->hasMany(User::class, 'loket_id');
    }
}

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Pengaturan extends Model
{
    use HasFactory;

    protected $table = 'settings';

    protected $fillable = [
        'logo',
        'nama_instansi',
        'alamat',
        'telepon',
        'deskripsi'
    ];
}

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class PrintHistory extends Model
{
    protected $fillable = [
        'antrian_id',
        'kode_antrian',
        'print_count',
        'last_printed_at',
        'printed_by',
    ];

    protected $casts = [
        'last_printed_at' => 'datetime',
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
    ];

    public function antrian()
    {
        return $this->belongsTo(Antrian::class);
    }
}

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class StatistikHarian extends Model
{
    use HasFactory;

    protected $table = 'statistik_harian';

    protected $fillable = [
        'tanggal',
        'layanan_id',
        'total_menunggu',
        'total_dilayani',
        'total_selesai',
        'total_batal'
    ];

    protected $casts = [
        'tanggal' => 'date'
    ];

    public function layanan(): BelongsTo
    {
        return $this->belongsTo(Layanan::class, 'layanan_id');
    }
}

<?php

namespace App\Models;

// use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
    /** @use HasFactory<\Database\Factories\UserFactory> */
    use HasFactory, Notifiable;

    /**
     * The attributes that are mass assignable.
     *
     * @var list<string>
     */
    protected $fillable = [
        'name',
        'username',
        'email',
        'password',
        'role',
        'loket_id',
        'status',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var list<string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * Get the attributes that should be cast.
     *
     * @return array<string, string>
     */
    protected function casts(): array
    {
        return [
            'email_verified_at' => 'datetime',
            'password' => 'hashed',
        ];
    }

    public function loket(): BelongsTo
    {
        return $this->belongsTo(Loket::class, 'loket_id');
    }

    public function activityLogs(): HasMany
    {
        return $this->hasMany(ActivityLog::class, 'user_id');
    }
}
<?php

namespace App\Services;

use App\Models\Antrian;
use App\Models\Loket;
use App\Models\Layanan;
use Carbon\Carbon;
use Illuminate\Support\Facades\DB;

class AnalyticsService
{
    /**
     * Get daily queue statistics
     */
    public static function getDailyStats($date = null)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        $stats = Antrian::whereDate('waktu_ambil', $date)->get();
        
        return [
            'date' => $date->format('Y-m-d'),
            'total_antrian' => $stats->count(),
            'selesai' => $stats->where('status', 'selesai')->count(),
            'batal' => $stats->where('status', 'batal')->count(),
            'menunggu' => $stats->where('status', 'menunggu')->count(),
            'completion_rate' => $stats->count() > 0 
                ? round(($stats->where('status', 'selesai')->count() / $stats->count()) * 100, 2)
                : 0,
        ];
    }

    /**
     * Get hourly distribution (peak hours)
     */
    public static function getHourlyDistribution($date = null)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        $data = Antrian::whereDate('waktu_ambil', $date)
            ->selectRaw('HOUR(waktu_ambil) as hour, COUNT(*) as count')
            ->groupBy('hour')
            ->orderBy('hour')
            ->get();
        
        // Fill empty hours with 0
        $hours = [];
        for ($i = 0; $i < 24; $i++) {
            $hours[$i] = 0;
        }
        
        foreach ($data as $item) {
            $hours[$item->hour] = $item->count;
        }
        
        return array_map(function($count) {
            return $count;
        }, $hours);
    }

    /**
     * Get service performance statistics
     */
    public static function getServiceStats($date = null)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        $layanans = Layanan::all();
        
        return $layanans->map(function($layanan) use ($date) {
            $antrians = Antrian::where('layanan_id', $layanan->id)
                ->whereDate('waktu_ambil', $date)
                ->get();
            
            $selesai = $antrians->where('status', 'selesai');
            $avgTime = self::calculateAverageServiceTime($selesai);
            
            return [
                'layanan_id' => $layanan->id,
                'nama_layanan' => $layanan->nama_layanan,
                'total' => $antrians->count(),
                'selesai' => $selesai->count(),
                'batal' => $antrians->where('status', 'batal')->count(),
                'menunggu' => $antrians->where('status', 'menunggu')->count(),
                'avg_service_time' => $avgTime,
            ];
        });
    }

    /**
     * Get loket performance statistics
     */
    public static function getLoketStats($date = null)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        $lokets = Loket::with('layanan')->get();
        
        return $lokets->map(function($loket) use ($date) {
            $antrians = Antrian::where('loket_id', $loket->id)
                ->whereDate('waktu_ambil', $date)
                ->get();
            
            $selesai = $antrians->where('status', 'selesai');
            $avgTime = self::calculateAverageServiceTime($selesai);
            
            return [
                'loket_id' => $loket->id,
                'nama_loket' => $loket->nama_loket,
                'layanan' => $loket->layanan->nama_layanan ?? 'N/A',
                'total' => $antrians->count(),
                'selesai' => $selesai->count(),
                'avg_service_time' => $avgTime,
                'efficiency' => $antrians->count() > 0 
                    ? round(($selesai->count() / $antrians->count()) * 100, 2)
                    : 0,
            ];
        });
    }

    /**
     * Get weekly comparison data
     */
    public static function getWeeklyComparison()
    {
        $data = [];
        
        for ($i = 6; $i >= 0; $i--) {
            $date = Carbon::today()->subDays($i);
            $count = Antrian::whereDate('waktu_ambil', $date)->count();
            
            $data[] = [
                'date' => $date->format('D'),
                'count' => $count,
            ];
        }
        
        return $data;
    }

    /**
     * Get top services (most visited)
     */
    public static function getTopServices($date = null, $limit = 5)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        return Antrian::where('status', 'selesai')
            ->whereDate('waktu_ambil', $date)
            ->selectRaw('layanan_id, COUNT(*) as count')
            ->with('layanan')
            ->groupBy('layanan_id')
            ->orderByDesc('count')
            ->limit($limit)
            ->get()
            ->map(function($item) {
                return [
                    'layanan' => $item->layanan->nama_layanan ?? 'Unknown',
                    'count' => $item->count,
                ];
            });
    }

    /**
     * Calculate average service time
     */
    private static function calculateAverageServiceTime($antrians)
    {
        if ($antrians->isEmpty()) {
            return 0;
        }
        
        $totalTime = 0;
        $count = 0;
        
        foreach ($antrians as $antrian) {
            if ($antrian->waktu_mulai_dilayani && $antrian->waktu_selesai) {
                $duration = $antrian->waktu_selesai->diffInMinutes($antrian->waktu_mulai_dilayani);
                $totalTime += $duration;
                $count++;
            }
        }
        
        return $count > 0 ? round($totalTime / $count, 1) : 0;
    }

    /**
     * Get date range stats (for custom reports)
     */
    public static function getDateRangeStats($startDate, $endDate)
    {
        $startDate = Carbon::parse($startDate)->startOfDay();
        $endDate = Carbon::parse($endDate)->endOfDay();
        
        $antrians = Antrian::whereBetween('waktu_ambil', [$startDate, $endDate])->get();
        
        return [
            'date_range' => $startDate->format('Y-m-d') . ' to ' . $endDate->format('Y-m-d'),
            'total_days' => $startDate->diffInDays($endDate) + 1,
            'total_antrian' => $antrians->count(),
            'total_selesai' => $antrians->where('status', 'selesai')->count(),
            'total_batal' => $antrians->where('status', 'batal')->count(),
            'avg_per_day' => round($antrians->count() / ($startDate->diffInDays($endDate) + 1), 2),
            'completion_rate' => $antrians->count() > 0
                ? round(($antrians->where('status', 'selesai')->count() / $antrians->count()) * 100, 2)
                : 0,
        ];
    }

    /**
     * Get current month stats summary
     */
    public static function getMonthStats($year = null, $month = null)
    {
        $year = $year ?? Carbon::now()->year;
        $month = $month ?? Carbon::now()->month;
        
        $startDate = Carbon::createFromDate($year, $month, 1)->startOfDay();
        $endDate = $startDate->copy()->endOfMonth();
        
        $antrians = Antrian::whereBetween('waktu_ambil', [$startDate, $endDate])->get();
        
        return [
            'month' => $startDate->format('F Y'),
            'total_antrian' => $antrians->count(),
            'total_selesai' => $antrians->where('status', 'selesai')->count(),
            'total_batal' => $antrians->where('status', 'batal')->count(),
            'completion_rate' => $antrians->count() > 0
                ? round(($antrians->where('status', 'selesai')->count() / $antrians->count()) * 100, 2)
                : 0,
            'avg_per_day' => round($antrians->count() / $startDate->diffInDays($endDate, false) + 1, 2),
        ];
    }
}


<?php

namespace App\Services;

use App\Models\AudioSetting;
use App\Models\Antrian;
use App\Models\Loket;

class AudioService
{
    /**
     * Generate audio text untuk panggilan antrian
     */
    public static function generateAudioText(Antrian $antrian)
    {
        $setting = AudioSetting::first() ?? new AudioSetting();
        
        $loket = $antrian->loket ? $antrian->loket->nama_loket : 'Loket';
        
        $pesan = str_replace(
            ['{nomor}', '{lokasi}'],
            [$antrian->kode_antrian, $loket],
            $setting->format_pesan
        );
        
        return $pesan;
    }

    /**
     * Generate URL TTS menggunakan Google Translate atau service lain
     */
    public static function generateTTSUrl(string $text, string $bahasa = 'id')
    {
        // Menggunakan Google Text-to-Speech API atau free service
        // Format: https://translate.google.com/translate_tts?ie=UTF-8&q={text}&tl={lang}
        
        $text = urlencode($text);
        return "https://translate.google.com/translate_tts?ie=UTF-8&q={$text}&tl={$bahasa}&client=tw-ob";
    }

    /**
     * Generate HTML audio tag untuk embed di view
     */
    public static function generateAudioTag(Antrian $antrian, string $id = 'audioNotifikasi')
    {
        $setting = AudioSetting::first();
        
        if (!$setting || !$setting->aktif) {
            return '';
        }

        $audioText = self::generateAudioText($antrian);
        $audioUrl = self::generateTTSUrl($audioText, $setting->bahasa);
        $volume = ($setting->volume / 100); // convert 0-100 to 0-1

        return <<<HTML
        <audio id="{$id}" preload="auto" style="display:none;">
            <source src="{$audioUrl}" type="audio/mpeg">
        </audio>
        <script>
            const audio = document.getElementById('{$id}');
            audio.volume = {$volume};
            audio.play().catch(err => console.log('Audio play error:', err));
        </script>
        HTML;
    }
}

<?php

namespace App\Services;

use Illuminate\Support\Facades\Log;
use App\Models\Antrian;
use App\Events\AntrianDipanggil;

/**
 * BroadcastTestService
 * 
 * Utility untuk testing broadcast event lokal
 * Gunakan di Tinker atau manual testing
 */
class BroadcastTestService
{
    /**
     * Test broadcast dengan random antrian
     * 
     * Usage:
     * >>> php artisan tinker
     * >>> BroadcastTestService::testBroadcast()
     */
    public static function testBroadcast()
    {
        $antrian = Antrian::with(['layanan'])->first();
        
        if (!$antrian) {
            return [
                'success' => false,
                'message' => 'No antrian found to broadcast'
            ];
        }

        try {
            // Broadcast event
            event(new AntrianDipanggil(
                $antrian,
                'TEST LOKET',
                $antrian->layanan?->nama_layanan ?? 'Test Service'
            ));

            Log::info('[TEST] Broadcast sent:', [
                'kode_antrian' => $antrian->kode_antrian,
                'loket' => 'TEST LOKET',
                'timestamp' => now(),
            ]);

            return [
                'success' => true,
                'message' => 'Broadcast test sent',
                'data' => [
                    'kode_antrian' => $antrian->kode_antrian,
                    'loket' => 'TEST LOKET',
                ]
            ];
        } catch (\Exception $e) {
            Log::error('[TEST] Broadcast error: ' . $e->getMessage());
            return [
                'success' => false,
                'message' => $e->getMessage()
            ];
        }
    }

    /**
     * Test dengan antrian spesifik
     */
    public static function testBroadcastWithCode($kodeAntrian)
    {
        $antrian = Antrian::where('kode_antrian', $kodeAntrian)->first();
        
        if (!$antrian) {
            return [
                'success' => false,
                'message' => "Antrian $kodeAntrian not found"
            ];
        }

        try {
            event(new AntrianDipanggil(
                $antrian,
                'LOKET TEST',
                'Service Test'
            ));

            Log::info('[TEST] Broadcast sent for: ' . $kodeAntrian);

            return [
                'success' => true,
                'message' => 'Broadcast sent',
                'kode' => $kodeAntrian
            ];
        } catch (\Exception $e) {
            Log::error('[TEST] Error: ' . $e->getMessage());
            return [
                'success' => false,
                'message' => $e->getMessage()
            ];
        }
    }

    /**
     * Test multiple broadcasts
     */
    public static function testMultipleBroadcasts($count = 3)
    {
        $results = [];
        
        $antrians = Antrian::take($count)->get();

        foreach ($antrians as $antrian) {
            try {
                event(new AntrianDipanggil(
                    $antrian,
                    'LOKET TEST ' . rand(1, 5),
                    'Service Test'
                ));

                $results[] = [
                    'success' => true,
                    'kode' => $antrian->kode_antrian
                ];
            } catch (\Exception $e) {
                $results[] = [
                    'success' => false,
                    'kode' => $antrian->kode_antrian,
                    'error' => $e->getMessage()
                ];
            }
        }

        Log::info('[TEST] Multiple broadcasts sent', ['count' => count($results)]);

        return [
            'total' => count($antrians),
            'results' => $results
        ];
    }
}

<?php

namespace App\Services;

use App\Models\ActivityLog;
use App\Models\Antrian;
use Illuminate\Support\Facades\Auth;

class LogActivityService
{
    public static function log($aktivitas)
    {
        if (Auth::check()) {
            ActivityLog::create([
                'user_id' => Auth::id(),
                'aktivitas' => $aktivitas,
                'waktu' => now(),
                'ip_address' => request()->ip(),
            ]);
        }
    }

    public static function antrianCreated(Antrian $antrian)
    {
        self::log("Antrian {$antrian->kode_antrian} dibuat");
    }

    public static function antrianCalled(Antrian $antrian)
    {
        self::log("Memanggil antrian {$antrian->kode_antrian}");
    }

    public static function antrianServed(Antrian $antrian)
    {
        self::log("Melayani antrian {$antrian->kode_antrian}");
    }

    public static function antrianCompleted(Antrian $antrian)
    {
        self::log("Menyelesaikan antrian {$antrian->kode_antrian}");
    }

    public static function antrianCancelled(Antrian $antrian)
    {
        self::log("Membatalkan antrian {$antrian->kode_antrian}");
    }
}

<?php

namespace App\Services;

use App\Models\Antrian;
use App\Models\User;
use App\Models\Loket;
use Carbon\Carbon;

class StaffPerformanceService
{
    /**
     * Get personal performance stats untuk staff
     */
    public static function getPersonalStats(User $user, $date = null)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        $loket = $user->loket;
        if (!$loket) {
            return null;
        }

        $antrians = Antrian::where('loket_id', $loket->id)
            ->whereDate('waktu_ambil', $date)
            ->get();

        $selesai = $antrians->where('status', 'selesai');
        $batal = $antrians->where('status', 'batal');
        
        $avgServiceTime = self::calculateAverageServiceTime($selesai);
        $totalServiceTime = self::calculateTotalServiceTime($selesai);

        return [
            'nama_staff' => $user->name,
            'loket' => $loket->nama_loket,
            'layanan' => $loket->layanan->nama_layanan ?? 'N/A',
            'total_antrian' => $antrians->count(),
            'selesai' => $selesai->count(),
            'batal' => $batal->count(),
            'menunggu' => $antrians->where('status', 'menunggu')->count(),
            'avg_service_time' => $avgServiceTime,
            'total_service_time' => $totalServiceTime,
            'efficiency' => $antrians->count() > 0 
                ? round(($selesai->count() / $antrians->count()) * 100, 2)
                : 0,
            'date' => $date->format('Y-m-d'),
        ];
    }

    /**
     * Get staff rankings
     */
    public static function getStaffRankings($date = null)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        $users = User::where('role', 'petugas')
            ->with('loket')
            ->get();

        $rankings = $users->map(function($user) use ($date) {
            $stats = self::getPersonalStats($user, $date);
            if (!$stats) {
                return null;
            }
            return $stats;
        })->filter()
          ->sortByDesc('efficiency')
          ->values();

        return $rankings;
    }

    /**
     * Get top performers
     */
    public static function getTopPerformers($limit = 5, $date = null)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        return self::getStaffRankings($date)
            ->take($limit);
    }

    /**
     * Get weekly performance trend
     */
    public static function getWeeklyPerformance(User $user)
    {
        $data = [];
        
        for ($i = 6; $i >= 0; $i--) {
            $date = Carbon::today()->subDays($i);
            $stats = self::getPersonalStats($user, $date);
            
            if ($stats) {
                $data[] = [
                    'date' => $date->format('D'),
                    'completed' => $stats['selesai'],
                    'efficiency' => $stats['efficiency'],
                    'avg_time' => $stats['avg_service_time'],
                ];
            }
        }
        
        return $data;
    }

    /**
     * Get monthly performance
     */
    public static function getMonthlyPerformance(User $user, $year = null, $month = null)
    {
        $year = $year ?? Carbon::now()->year;
        $month = $month ?? Carbon::now()->month;
        
        $startDate = Carbon::createFromDate($year, $month, 1)->startOfDay();
        $endDate = $startDate->copy()->endOfMonth();

        $loket = $user->loket;
        if (!$loket) {
            return null;
        }

        $antrians = Antrian::where('loket_id', $loket->id)
            ->whereBetween('waktu_ambil', [$startDate, $endDate])
            ->get();

        $selesai = $antrians->where('status', 'selesai');
        
        return [
            'month' => $startDate->format('F Y'),
            'nama_staff' => $user->name,
            'loket' => $loket->nama_loket,
            'total_antrian' => $antrians->count(),
            'total_selesai' => $selesai->count(),
            'total_batal' => $antrians->where('status', 'batal')->count(),
            'avg_service_time' => self::calculateAverageServiceTime($selesai),
            'total_service_time' => self::calculateTotalServiceTime($selesai),
            'efficiency' => $antrians->count() > 0
                ? round(($selesai->count() / $antrians->count()) * 100, 2)
                : 0,
        ];
    }

    /**
     * Get team performance
     */
    public static function getTeamPerformance($layananId = null, $date = null)
    {
        $date = $date ? Carbon::parse($date) : Carbon::today();
        
        $lokets = Loket::when($layananId, function($query) use ($layananId) {
            $query->where('layanan_id', $layananId);
        })->with('layanan')->get();

        return $lokets->map(function($loket) use ($date) {
            $user = User::where('loket_id', $loket->id)->first();
            
            if (!$user) {
                return null;
            }

            return self::getPersonalStats($user, $date);
        })->filter();
    }

    /**
     * Calculate average service time
     */
    private static function calculateAverageServiceTime($antrians)
    {
        if ($antrians->isEmpty()) {
            return 0;
        }

        $totalTime = 0;
        $count = 0;

        foreach ($antrians as $antrian) {
            if ($antrian->waktu_mulai_dilayani && $antrian->waktu_selesai) {
                $duration = $antrian->waktu_selesai->diffInMinutes($antrian->waktu_mulai_dilayani);
                $totalTime += $duration;
                $count++;
            }
        }

        return $count > 0 ? round($totalTime / $count, 1) : 0;
    }

    /**
     * Calculate total service time in minutes
     */
    private static function calculateTotalServiceTime($antrians)
    {
        $totalTime = 0;

        foreach ($antrians as $antrian) {
            if ($antrian->waktu_mulai_dilayani && $antrian->waktu_selesai) {
                $duration = $antrian->waktu_selesai->diffInMinutes($antrian->waktu_mulai_dilayani);
                $totalTime += $duration;
            }
        }

        return $totalTime;
    }

    /**
     * Get staff goal progress
     */
    public static function getGoalProgress(User $user, $targetPerDay = 50)
    {
        $today = Carbon::today();
        
        $stats = self::getPersonalStats($user, $today);
        if (!$stats) {
            return null;
        }

        $progress = round(($stats['selesai'] / $targetPerDay) * 100, 1);
        $remaining = max(0, $targetPerDay - $stats['selesai']);

        return [
            'target' => $targetPerDay,
            'completed' => $stats['selesai'],
            'remaining' => $remaining,
            'progress_percentage' => min(100, $progress),
            'status' => $progress >= 100 ? 'achieved' : ($progress >= 75 ? 'on_track' : 'behind'),
        ];
    }
}

<?php

namespace App\Services;

use App\Models\Antrian;
use App\Models\Loket;
use Carbon\Carbon;

class WaitTimeService
{
    /**
     * Hitung rata-rata durasi pelayanan per loket hari ini
     */
    public static function getAverageServiceTime(Loket $loket)
    {
        $today = Carbon::today();
        
        $completed = Antrian::where('loket_id', $loket->id)
            ->whereDate('waktu_ambil', $today)
            ->whereIn('status', ['selesai', 'batal'])
            ->whereNotNull('waktu_mulai_dilayani')
            ->whereNotNull('waktu_selesai')
            ->get();

        if ($completed->isEmpty()) {
            return 0;
        }

        $totalDuration = 0;
        $count = 0;

        foreach ($completed as $antrian) {
            if ($antrian->waktu_mulai_dilayani && $antrian->waktu_selesai) {
                $duration = $antrian->waktu_selesai->diffInMinutes($antrian->waktu_mulai_dilayani);
                $totalDuration += $duration;
                $count++;
            }
        }

        return $count > 0 ? round($totalDuration / $count, 1) : 0;
    }

    /**
     * Hitung estimasi waktu tunggu untuk loket tertentu
     */
    public static function getEstimatedWaitTime(Loket $loket)
    {
        $today = Carbon::today();
        
        // Hitung jumlah antrian yang sedang menunggu
        $waiting = Antrian::where('loket_id', $loket->id)
            ->whereDate('waktu_ambil', $today)
            ->whereIn('status', ['menunggu', 'dipanggil'])
            ->count();

        // Ambil rata-rata waktu pelayanan
        $avgTime = self::getAverageServiceTime($loket);

        // Estimasi = jumlah menunggu * rata-rata waktu pelayanan
        return max(0, round($waiting * $avgTime));
    }

    /**
     * Get estimated wait time untuk semua loket
     */
    public static function getAllEstimatedWaitTimes()
    {
        $lokets = Loket::with('layanan')->get();
        
        return $lokets->map(function ($loket) {
            return [
                'loket_id' => $loket->id,
                'nama_loket' => $loket->nama_loket,
                'layanan' => $loket->layanan->nama_layanan ?? 'N/A',
                'estimated_minutes' => self::getEstimatedWaitTime($loket),
                'average_service_time' => self::getAverageServiceTime($loket),
            ];
        });
    }

    /**
     * Format waktu tunggu menjadi readable text
     */
    public static function formatWaitTime($minutes)
    {
        if ($minutes <= 0) {
            return "Segera";
        } elseif ($minutes < 1) {
            return "< 1 menit";
        } elseif ($minutes == 1) {
            return "1 menit";
        } elseif ($minutes < 60) {
            return "{$minutes} menit";
        } else {
            $hours = intval($minutes / 60);
            $mins = $minutes % 60;
            return "{$hours}jam {$mins}menit";
        }
    }
}

<?php

use App\Http\Controllers\AuthController;
use App\Http\Controllers\DisplayController;
use App\Http\Controllers\KiosController;
use App\Http\Controllers\StatusController;
use App\Http\Controllers\Admin\DashboardController;
use App\Http\Controllers\Admin\LayananController;
use App\Http\Controllers\Admin\LoketController;
use App\Http\Controllers\Admin\PenggunaController;
use App\Http\Controllers\Admin\PengaturanController;
use App\Http\Controllers\Admin\AntrianController;
use App\Http\Controllers\Admin\AudioSettingController;
use App\Http\Controllers\Admin\AnalyticsController;
use App\Http\Controllers\Admin\PrintController;
use App\Http\Controllers\Admin\AdvancedSettingController;
use App\Http\Controllers\Petugas\LoketPetugasController;
use Illuminate\Support\Facades\Route;

// Auth Routes
Route::get('/login', [AuthController::class, 'showLogin'])->name('login');
Route::post('/login', [AuthController::class, 'login'])->name('login.post');
Route::post('/logout', [AuthController::class, 'logout'])->name('logout');

// Public Routes
Route::get('/', function () {
    return redirect()->route('login');
});
Route::get('/display', [DisplayController::class, 'index'])->name('display.index');
Route::get('/display/data', [DisplayController::class, 'getData'])->name('display.data');
Route::get('/kios', [KiosController::class, 'index'])->name('kios.index');
Route::get('/kios/wait-times', [KiosController::class, 'getWaitTimes'])->name('kios.wait-times');
Route::post('/kios/store', [KiosController::class, 'cetak'])->name('kios.store');
Route::post('/kios/print', [KiosController::class, 'cetak'])->name('kios.print');
Route::get('/waiting', function () {
    $pengaturan = \App\Models\Pengaturan::first();
    return view('waiting.index', compact('pengaturan'));
})->name('waiting.index');
Route::get('/antrian/status', [StatusController::class, 'waitingStatus'])->name('antrian.status');
Route::withoutMiddleware('Illuminate\Foundation\Http\Middleware\VerifyCsrfToken')->group(function () {
    Route::post('/kios/cetak', [KiosController::class, 'cetak'])->name('kios.cetak');
    Route::post('/kios/store', [KiosController::class, 'cetak'])->name('kios.store');
    Route::post('/status/check', [StatusController::class, 'check'])->name('status.check');
    Route::get('/display/data', [DisplayController::class, 'getData'])->name('display.data');
    Route::get('/antrian/status', [StatusController::class, 'waitingStatus'])->name('antrian.status');
});
Route::get('/status', [StatusController::class, 'index'])->name('status.index');
Route::get('/status/show', [StatusController::class, 'show'])->name('status.show');

// Testing Routes (Development Only)
if (env('APP_DEBUG', false)) {
    Route::get('/test/broadcast', function () {
        return view('test.broadcast');
    })->name('test.broadcast');
    
    Route::get('/test/audio', function () {
        return view('test-audio');
    })->name('test.audio');
    
    Route::post('/test/broadcast/send', function () {
        $service = new \App\Services\BroadcastTestService();
        return response()->json($service->testBroadcast());
    })->name('test.broadcast.send');
}

// Admin Routes
Route::middleware(['auth'])->prefix('admin')->name('admin.')->group(function () {
    Route::get('/dashboard', [DashboardController::class, 'index'])->name('dashboard');
    
    Route::resource('layanan', LayananController::class);
    Route::resource('loket', LoketController::class);
    Route::post('loket/{loket}/toggle', [LoketController::class, 'toggleStatus'])->name('loket.toggle');
    Route::resource('pengguna', PenggunaController::class);
    
    Route::get('/pengaturan', [PengaturanController::class, 'index'])->name('pengaturan.index');
    Route::post('/pengaturan', [PengaturanController::class, 'update'])->name('pengaturan.update');
    
    Route::get('/audio-settings', [AudioSettingController::class, 'index'])->name('audio-settings.index');
    Route::post('/audio-settings', [AudioSettingController::class, 'update'])->name('audio-settings.update');
    Route::get('/audio-settings/test', [AudioSettingController::class, 'testAudio'])->name('audio-settings.test');
    
    Route::get('/antrian', [AntrianController::class, 'index'])->name('antrian.index');
    
    Route::get('/analytics', [AnalyticsController::class, 'index'])->name('analytics.index');
    Route::get('/analytics/chart-data', [AnalyticsController::class, 'getChartData'])->name('analytics.chart-data');
    Route::get('/analytics/detail-stats', [AnalyticsController::class, 'getDetailStats'])->name('analytics.detail-stats');
    Route::get('/analytics/export', [AnalyticsController::class, 'exportReport'])->name('analytics.export');
    
    Route::get('/print', [PrintController::class, 'index'])->name('print.index');
    Route::get('/print/search', [PrintController::class, 'search'])->name('print.search');
    Route::post('/print/reprint', [PrintController::class, 'reprint'])->name('print.reprint');
    Route::get('/print/history', [PrintController::class, 'getHistory'])->name('print.history');
    
    Route::get('/advanced-settings', [AdvancedSettingController::class, 'index'])->name('advanced-settings.index');
    Route::post('/advanced-settings', [AdvancedSettingController::class, 'update'])->name('advanced-settings.update');
});

// Petugas Routes
Route::middleware(['auth'])->prefix('petugas')->name('petugas.')->group(function () {
    Route::get('/loket', [LoketPetugasController::class, 'index'])->name('loket.index');
    Route::get('/loket/list', [LoketPetugasController::class, 'getAntrianList'])->name('loket.list');
    Route::post('/loket/panggil', [LoketPetugasController::class, 'panggil'])->name('loket.panggil');
    Route::post('/loket/layani', [LoketPetugasController::class, 'layani'])->name('loket.layani');
    Route::post('/loket/selesai', [LoketPetugasController::class, 'selesai'])->name('loket.selesai');
    Route::post('/loket/batalkan', [LoketPetugasController::class, 'batalkan'])->name('loket.batalkan');
    Route::post('/loket/tutup', [LoketPetugasController::class, 'tutupLoket'])->name('loket.tutup');
});